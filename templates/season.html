<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ season.name }}</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>{{ season.name }}</h1>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="seasons.html">Seasons</a></li>
            <li><a href="players.html">Players</a></li>
            <li><a href="leaderboards.html">Leaderboards</a></li>
        </ul>
    </nav>

    <p><a href="https://app.matchplay.events/series/{{ season.seriesId }}" target="_blank">View on Matchplay.events</a></p>
    {% if finals_tournament_ids %}
        {% if finals_tournament_ids is string or finals_tournament_ids is number %} {# Handle single ID #}
            <p><a href="https://app.matchplay.events/tournaments/{{ finals_tournament_ids }}" target="_blank">View Finals Tournament on Matchplay.events</a></p>
        {% else %} {# Handle list of IDs #}
            <p>View Finals Tournaments on Matchplay.events:
                {% for tid in finals_tournament_ids %}
                    <a href="https://app.matchplay.events/tournaments/{{ tid }}" target="_blank">Part {{ loop.index }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
        {% endif %}
    {% endif %}

    {% if finals_results %}
        <h2>Finals Results</h2>
        <table>
            <thead>
                <tr>
                    <th>Position</th>
                    <th>Player</th>
                </tr>
            </thead>
            <tbody>
                {% for result in finals_results %}
                    <tr>
                        <td>{{ result.position }}</td>
                        <td><a href="player_{{ result.playerId }}.html">{{ result.name }}</a></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

    <h2>Player Performance in {{ season.name }}</h2>
    {% if season_players_data %}
        <table>
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Overall Final Position</th> {# Renamed column header #}
                    <th>Total Adjusted Points</th>
                    <th>Total Raw Points</th>
                    <th>Weeks Played</th>
                    <th>Avg Points/Week</th>
                    {% for i in range(1, 11) %}
                        <th>Week {{ i }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for player_data in season_players_data %}
                    <tr>
                        <td><a href="player_{{ player_data.playerId }}.html">{{ player_data.name }}</a></td>
                        <td>{{ player_data.overall_final_position }}</td> {# Display new overall_final_position #}
                        <td>{{ player_data.total_adjusted_points | format_number }}</td>
                        <td>{{ player_data.total_raw_points | format_number }}</td>
                        <td>{{ player_data.weekly_scores | select('ne', 'N/A') | list | length }}</td>
                        <td>{{ player_data.average_points_per_week | format_number }}</td>
                        {% for score in player_data.weekly_scores %}
                            <td>{{ score | score_color_code | safe }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No player performance data available for this season.</p>
    {% endif %}
</body>
</html>
